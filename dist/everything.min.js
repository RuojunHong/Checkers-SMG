!function(){"use strict";angular.module("myApp",["ngTouch","ui.bootstrap"]).factory("checkersLogicService",[function(){function a(a){var b;for(b in a)if(a.hasOwnProperty(b))return!1;return!0}function b(a){return a.substr(0,1)}function c(a){return a.substr(1)}function d(a,b){return a.row!==b.row?!1:a.col!==b.col?!1:!0}function e(a,b){var c;for(c=0;c<a.length;c+=1)if(d(a[c],b))return!0;return!1}function f(a,b){return a===G.BLACK_INDEX&&b===G.BLACK||a===G.WHITE_INDEX&&b===G.WHITE?!0:!1}function g(a){var b,c,d=a.row,e=a.col;return a.hasOwnProperty("row")&&a.hasOwnProperty("col")?0>d||d>=G.ROW||0>e||e>=G.COLUMN?!1:(b=d%2===0,c=e%2===0,!b&&c||b&&!c?!0:!1):!1}function h(a,d,e){var f=a[d.row][d.col];if(c(f)===G.KING){if(1===Math.abs(d.row-e.row)&&1===Math.abs(d.col-e.col))return!0}else if(b(f)===G.BLACK){if(d.row-e.row===-1&&1===Math.abs(d.col-e.col))return!0}else if(b(f)===G.WHITE&&d.row-e.row===1&&1===Math.abs(d.col-e.col))return!0;return!1}function i(a,d,e){var f=a[d.row][d.col];if(c(f)===G.KING){if(2===Math.abs(d.row-e.row)&&2===Math.abs(d.col-e.col))return!0}else if(b(f)===G.BLACK){if(d.row-e.row===-2&&2===Math.abs(d.col-e.col))return!0}else if(b(f)===G.WHITE&&d.row-e.row===2&&2===Math.abs(d.col-e.col))return!0;return!1}function j(a,b,c){return b!==G.DARK_SQUARE&&a.substr(0,1)!==b.substr(0,1)&&c===G.DARK_SQUARE}function k(a,b){return b===G.WHITE_INDEX&&0===a.row||b===G.BLACK_INDEX&&a.row===G.ROW-1?!0:!1}function l(a){var b="";switch(a){case D.ILLEGAL_MOVE:b="ILLEGAL_MOVE";break;case D.ILLEGAL_SIMPLE_MOVE:b="ILLEGAL_SIMPLE_MOVE";break;case D.ILLEGAL_JUMP_MOVE:b="ILLEGAL_JUMP_MOVE";break;case D.ILLEGAL_DELTA:b="ILLEGAL_DELTA";break;case D.ILLEGAL_COLOR_CHANGED:b="ILLEGAL_COLOR_CHANGED";break;case D.ILLEGAL_CROWNED:b="ILLEGAL_CROWNED";break;case D.ILLEGAL_UNCROWNED:b="ILLEGAL_UNCROWNED";break;case D.ILLEGAL_IGNORE_MANDATORY_JUMP:b="ILLEGAL_IGNORE_MANDATORY_JUMP";break;case D.ILLEGAL_SET_TURN:b="ILLEGAL_SET_TURN";break;case D.ILLEGAL_END_MATCH_SCORE:b="ILLEGAL_END_MATCH_SCORE";break;default:throw new Error("Illegal code!!!")}return b}function m(a){return{email:"yl1949@nyu.edu",emailSubject:"hacker!",emailBody:l(a)}}function n(a,b,c){var d={row:-1,col:-1};if(!g(a))throw new Error("Illegal from coordinate!!!");switch(b){case F.SIMPLE_MOVE:switch(c){case E.UP_LEFT:d.row=a.row-1,d.col=a.col-1;break;case E.UP_RIGHT:d.row=a.row-1,d.col=a.col+1;break;case E.DOWN_LEFT:d.row=a.row+1,d.col=a.col-1;break;case E.DOWN_RIGHT:d.row=a.row+1,d.col=a.col+1;break;default:throw new Error("Illegal direction!")}break;case F.JUMP_MOVE:switch(c){case E.UP_LEFT:d.row=a.row-2,d.col=a.col-2;break;case E.UP_RIGHT:d.row=a.row-2,d.col=a.col+2;break;case E.DOWN_LEFT:d.row=a.row+2,d.col=a.col-2;break;case E.DOWN_RIGHT:d.row=a.row+2,d.col=a.col+2;break;default:throw new Error(D.ILLEGAL_MOVE)}break;default:throw new Error(D.ILLEGAL_MOVE)}if(!g(d))throw new Error(D.ILLEGAL_DELTA);return d}function o(){var a,b=[];return b.push({setTurn:{turnIndex:0}}),a=[["--","BM","--","BM","--","BM","--","BM"],["BM","--","BM","--","BM","--","BM","--"],["--","BM","--","BM","--","BM","--","BM"],["DS","--","DS","--","DS","--","DS","--"],["--","DS","--","DS","--","DS","--","DS"],["WM","--","WM","--","WM","--","WM","--"],["--","WM","--","WM","--","WM","--","WM"],["WM","--","WM","--","WM","--","WM","--"]],b.push({set:{key:"board",value:a}}),b}function p(a,b){var c,d,e=[];return 0===b.row?e:(b.row%2===0?(c=n(b,F.SIMPLE_MOVE,E.UP_LEFT),a[c.row][c.col]===G.DARK_SQUARE&&e.push(c),b.col!==G.COLUMN-1&&(d=n(b,F.SIMPLE_MOVE,E.UP_RIGHT),a[d.row][d.col]===G.DARK_SQUARE&&e.push(d))):(0!==b.col&&(c=n(b,F.SIMPLE_MOVE,E.UP_LEFT),a[c.row][c.col]===G.DARK_SQUARE&&e.push(c)),d=n(b,F.SIMPLE_MOVE,E.UP_RIGHT),a[d.row][d.col]===G.DARK_SQUARE&&e.push(d)),e)}function q(a,b){var c,d,e=[];return b.row===G.ROW-1?e:(b.row%2===0?(c=n(b,F.SIMPLE_MOVE,E.DOWN_LEFT),a[c.row][c.col]===G.DARK_SQUARE&&e.push(c),b.col!==G.COLUMN-1&&(d=n(b,F.SIMPLE_MOVE,E.DOWN_RIGHT),a[d.row][d.col]===G.DARK_SQUARE&&e.push(d))):(0!==b.col&&(c=n(b,F.SIMPLE_MOVE,E.DOWN_LEFT),a[c.row][c.col]===G.DARK_SQUARE&&e.push(c)),d=n(b,F.SIMPLE_MOVE,E.DOWN_RIGHT),a[d.row][d.col]===G.DARK_SQUARE&&e.push(d)),e)}function r(a,b){var c={row:-1,col:-1};if(!g(a)||!g(b))throw new Error("Illegal coordinate!!!");return 2===Math.abs(a.row-b.row)&&2===Math.abs(a.col-b.col)&&(c.row=(a.row+b.row)/2,c.col=(a.col+b.col)/2),c}function s(a,b){var c,d,e,f,g=[],h=b,i=a[b.row][b.col];return h.row<2?g:(h.col>1&&(e=n(b,F.JUMP_MOVE,E.UP_LEFT),c=r(h,e),f=a[e.row][e.col],d=a[c.row][c.col],j(i,d,f)&&g.push(e)),h.col<G.COLUMN-2&&(e=n(b,F.JUMP_MOVE,E.UP_RIGHT),c=r(h,e),f=a[e.row][e.col],d=a[c.row][c.col],j(i,d,f)&&g.push(e)),g)}function t(a,b){var c,d,e,f,g=b,h=a[b.row][b.col],i=[];return g.row>G.ROW-3?i:(g.col>1&&(e=n(b,F.JUMP_MOVE,E.DOWN_LEFT),c=r(g,e),f=a[e.row][e.col],d=a[c.row][c.col],j(h,d,f)&&i.push(e)),g.col<G.COLUMN-2&&(e=n(b,F.JUMP_MOVE,E.DOWN_RIGHT),c=r(g,e),f=a[e.row][e.col],d=a[c.row][c.col],j(h,d,f)&&i.push(e)),i)}function u(a,b,c){var d=[],e=[],g=a[b.row][b.col],h=g.substr(0,1),i=g.substr(1);return f(c,h)&&(i===G.KING?(e=p(a,b),d=d.concat(e),e=q(a,b),d=d.concat(e)):h===G.WHITE?(e=p(a,b),d=d.concat(e)):h===G.BLACK&&(e=q(a,b),d=d.concat(e))),d}function v(a,b,c){var d=[],e=[],g=a[b.row][b.col],h=g.substr(0,1),i=g.substr(1);return f(c,h)&&(i===G.KING?(e=s(a,b),d=d.concat(e),e=t(a,b),d=d.concat(e)):h===G.WHITE?(e=s(a,b),d=d.concat(e)):h===G.BLACK&&(e=t(a,b),d=d.concat(e))),d}function w(a,b,c){var d;return d=v(a,b,c),0===d.length&&(d=u(a,b,c)),d}function x(a,c){var d,e,f,g,h,i=[],j={row:-1,col:-1};for(g=0;g<G.ROW;g+=1)for(h=0;h<G.COLUMN&&(b(a[g][h])===G.WHITE?d=!0:b(a[g][h])===G.BLACK&&(e=!0),d!==!0||e!==!0);h+=1);if(d&&!e)return G.WHITE;if(!d&&e)return G.BLACK;for(g=0;g<G.ROW;g+=1)for(h=0;h<G.COLUMN;h+=1)j.row=g,j.col=h,f=a[g][h],i=i.concat(c===G.BLACK_INDEX?w(a,j,1-c):w(a,j,1-c));return 0===i.length?c===G.BLACK_INDEX?G.BLACK:G.WHITE:""}function y(a,b){var c,d,e=[],f={row:-1,col:-1};for(c=0;c<G.ROW;c+=1)for(d=0;d<G.COLUMN;d+=1)f.row=c,f.col=d,e=e.concat(v(a,f,b));return e.length>0}function z(a,c,d,f){var j,l,m,n,o,p=!1,q=!1;if(!g(c)||!g(d))throw new Error(D.ILLEGAL_DELTA);if(h(a,c,d)?q=!0:i(a,c,d)&&(p=!0),q){if(y(a,f))throw new Error(D.ILLEGAL_IGNORE_MANDATORY_JUMP);if(l=u(a,c,f),!e(l,d))throw new Error(D.ILLEGAL_SIMPLE_MOVE)}else{if(!p)throw new Error(D.ILLEGAL_MOVE);if(m=v(a,c,f),!e(m,d))throw new Error(D.ILLEGAL_JUMP_MOVE)}q?(a[d.row][d.col]=a[c.row][c.col],a[c.row][c.col]=G.DARK_SQUARE):p&&(o=r(c,d),a[d.row][d.col]=a[c.row][c.col],a[c.row][c.col]=G.DARK_SQUARE,a[o.row][o.col]=G.DARK_SQUARE);var s=k(d,f);return s&&(b(a[d.row][d.col])===G.BLACK?a[d.row][d.col]=G.BLACK_KING:b(a[d.row][d.col])===G.WHITE&&(a[d.row][d.col]=G.WHITE_KING)),n=x(a,f),""!==n?j={endMatch:{endMatchScores:n===G.WHITE?[1,0]:[0,1]}}:(m=v(a,d,f),j=p&&m.length>0?s?{setTurn:{turnIndex:1-f}}:{setTurn:{turnIndex:f}}:{setTurn:{turnIndex:1-f}}),[j,{set:{key:"board",value:a}},{set:{key:"fromDelta",value:c}},{set:{key:"toDelta",value:d}}]}function A(b,c){var d,e,f,g,h=b.stateBeforeMove,i=b.turnIndexBeforeMove,j=b.move;if(a(h))return angular.equals(j,o());if(4!==j.length)return m(D.ILLEGAL_MOVE);try{if(d=h.board,e=j[2].set.value,f=j[3].set.value,g=z(d,e,f,i),c&&(console.log("Debug"),console.log(JSON.stringify(j)),console.log(JSON.stringify(g)),console.log(angular.equals(j,g))),!angular.equals(j,g))return m(D.ILLEGAL_MOVE)}catch(k){switch(k.message){case D.ILLEGAL_MOVE:return m(D.ILLEGAL_MOVE);case D.ILLEGAL_SIMPLE_MOVE:return m(D.ILLEGAL_SIMPLE_MOVE);case D.ILLEGAL_JUMP_MOVE:return m(D.ILLEGAL_JUMP_MOVE);case D.ILLEGAL_DELTA:return m(D.ILLEGAL_DELTA);case D.ILLEGAL_COLOR_CHANGED:return m(D.ILLEGAL_COLOR_CHANGED);case D.ILLEGAL_CROWNED:return m(D.ILLEGAL_CROWNED);case D.ILLEGAL_UNCROWNED:return m(D.ILLEGAL_UNCROWNED);case D.ILLEGAL_IGNORE_MANDATORY_JUMP:return m(D.ILLEGAL_IGNORE_MANDATORY_JUMP);case D.ILLEGAL_SET_TURN:return m(D.ILLEGAL_SET_TURN);case D.ILLEGAL_END_MATCH_SCORE:return m(D.ILLEGAL_END_MATCH_SCORE);default:return m(D.ILLEGAL_CODE)}}return!0}function B(){return[["--","BM","--","BM","--","BM","--","BM"],["BM","--","BM","--","BM","--","BM","--"],["--","BM","--","BM","--","BM","--","BM"],["DS","--","DS","--","DS","--","DS","--"],["--","DS","--","DS","--","DS","--","DS"],["WM","--","WM","--","WM","--","WM","--"],["--","WM","--","WM","--","WM","--","WM"],["WM","--","WM","--","WM","--","WM","--"]]}var C={ILLEGAL_CODE:{ILLEGAL_MOVE:"ILLEGAL_MOVE",ILLEGAL_SIMPLE_MOVE:"ILLEGAL_SIMPLE_MOVE",ILLEGAL_JUMP_MOVE:"ILLEGAL_JUMP_MOVE",ILLEGAL_DELTA:"ILLEGAL_DELTA",ILLEGAL_COLOR_CHANGED:"ILLEGAL_COLOR_CHANGED",ILLEGAL_CROWNED:"ILLEGAL_CROWNED",ILLEGAL_UNCROWNED:"ILLEGAL_UNCROWNED",ILLEGAL_IGNORE_MANDATORY_JUMP:"ILLEGAL_IGNORE_MANDATORY_JUMP",ILLEGAL_SET_TURN:"ILLEGAL_SET_TURN",ILLEGAL_END_MATCH_SCORE:"ILLEGAL_END_MATCH_SCORE",ILLEGAL_CODE:"ILLEGAL_CODE"},DIRECTION:{UP_LEFT:"UP_LEFT",UP_RIGHT:"UP_RIGHT",DOWN_LEFT:"DOWN_LEFT",DOWN_RIGHT:"DOWN_RIGHT"},MOVE_TYPE:{SIMPLE_MOVE:"SIMPLE_MOVE",JUMP_MOVE:"JUMP_MOVE"}},D=C.ILLEGAL_CODE,E=C.DIRECTION,F=C.MOVE_TYPE,G={ROW:8,COLUMN:8,LIGHT_SQUARE:"--",DARK_SQUARE:"DS",BLACK_MAN:"BM",BLACK_KING:"BK",WHITE_MAN:"WM",WHITE_KING:"WK",BLACK:"B",WHITE:"W",MAN:"M",KING:"K",WHITE_INDEX:0,BLACK_INDEX:1};return{isMoveOk:A,getFirstMove:o,createMove:z,getJumpMoves:v,getSimpleMoves:u,getAllPossibleMoves:w,hasMandatoryJumps:y,getJumpedDelta:r,isOwnColor:f,getIllegalEmailObj:m,getWinner:x,getColor:b,getKind:c,isEmptyObj:a,isSimpleMove:h,isJumpMove:i,getInitialBoard:B,CONSTANTS:G}}])}(),angular.module("myApp").controller("CheckersCtrl",["$scope","$log","$timeout","$translate","gameService","stateService","checkersLogicService","checkersAiService","resizeGameAreaService","dragAndDropService",function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(b,c,d){var e=n(),f=Math.min(Math.max(c-y.offsetLeft,e.width/2),y.clientWidth-e.width/2),g=Math.min(Math.max(d-y.offsetTop,e.height/2),y.clientHeight-e.height/2),h={row:Math.floor(x.ROW*g/y.clientHeight),col:Math.floor(x.COLUMN*f/y.clientWidth)},i=p(h);if("touchstart"===b&&q(h.row,h.col)&&D(A))A=angular.copy(h),a.hasPiece(h.row,h.col)&&a.isYourTurn&&l(i)&&(B=document.getElementById("img_"+A.row+"_"+A.col));else if("touchend"!==b||D(A))"touchmove"!==b||D(A)||m({top:g-.605*e.height,left:f-.605*e.width});else{var j={row:A.row,col:A.col},k={row:h.row,col:h.col};u(p(j),p(k)),m(o(A.row,A.col)),A=null,D(B)||(B.removeAttribute("style"),B=null)}("touchend"===b||"touchcancel"===b||"touchleave"===b)&&(A=null,B=null)}function l(b){return g.isOwnColor(a.yourPlayerIndex,a.board[b.row][b.col].substring(0,1))}function m(a){var b=n(),c=b.height/10,d=b.width/10,e=o(A.row,A.col);null!==B&&(B.style.left=a.left-e.left+d+"px",B.style.top=a.top-e.top+c+"px")}function n(){return{width:y.clientWidth/x.COLUMN,height:y.clientHeight/x.ROW}}function o(a,b){var c=n();return{top:a*c.height,left:b*c.width}}function p(b){return a.rotate?{row:x.ROW-b.row-1,col:x.COLUMN-b.col-1}:b}function q(b,c){var d={row:b,col:c},e=p(d);if(!a.hasPiece(b,c)||!l(e)||a.isAiMove)return!1;var f,h=g.hasMandatoryJumps(a.board,a.yourPlayerIndex);return f=h?g.getJumpMoves(a.board,e,a.yourPlayerIndex):g.getSimpleMoves(a.board,e,a.yourPlayerIndex),f.length>0}function r(a,b){return a*x.COLUMN+b}function s(a,b,c,d){var e=r(a.row,a.col),f=r(b.row,b.col),g=document.getElementById("img_"+a.row+"_"+a.col);switch(f-e){case x.COLUMN+1:t(g,c,"move_down_right","move_up_left");break;case x.COLUMN-1:t(g,c,"move_down_left","move_up_right");break;case-x.COLUMN+1:t(g,c,"move_up_right","move_down_left");break;case-x.COLUMN-1:t(g,c,"move_up_left","move_down_right");break;case 2*x.COLUMN+2:t(g,c,"jump_down_right","jump_up_left");break;case 2*x.COLUMN-2:t(g,c,"jump_down_left","jump_up_right");break;case-(2*x.COLUMN)+2:t(g,c,"jump_up_right","jump_down_left");break;case-(2*x.COLUMN)-2:t(g,c,"jump_up_left","jump_down_right")}c?(g.addEventListener("animationend",d,!1),g.addEventListener("webkitAnimationEnd",d,!1)):(g.removeEventListener("animationend"),g.removeEventListener("webkitAnimationEnd"),d())}function t(b,c,d,e){c?b.className+=a.rotate?" "+e:" "+d:b.className="piece"}function u(b,c){var d;try{d=g.createMove(angular.copy(a.board),b,c,a.yourPlayerIndex)}catch(f){return}z||(z=!0,e.makeMove(d))}function v(){var b,c=1e3;b=h.createComputerMove(a.board,a.yourPlayerIndex,{millisecondsLimit:c});var d=b[b.length-2],e=b[b.length-1],f={row:d.set.value.row,col:d.set.value.col},g={row:e.set.value.row,col:e.set.value.col};C={from:f,to:g},s(f,g,!0,function(){u(f,g)})}function w(b){return z=!1,a.rotate="playBlack"===b.playMode?!0:!1,a.yourPlayerIndex=b.yourPlayerIndex,a.playersInfo=b.playersInfo,a.board=b.stateAfterMove.board,D(a.board)&&0===b.yourPlayerIndex?void E():(a.isYourTurn=b.turnIndexAfterMove>=0&&b.yourPlayerIndex===b.turnIndexAfterMove,a.isPlayerMove=a.isYourTurn&&""!==b.playersInfo[b.yourPlayerIndex].playerId,a.isAiMove=a.isYourTurn&&""===b.playersInfo[b.yourPlayerIndex].playerId,D(C)||s(C.from,C.to,!1,function(){C=null}),void(a.isAiMove&&c(v,500)))}console.log("Translation of 'RULES_OF_TICTACTOE' is "+d("RULES_OF_CHECKERS"));var x=g.CONSTANTS,y=document.getElementById("gameArea"),z=!1,A=null,B=null,C=null,D=function(a){return angular.isUndefined(a)||null===a};a.isDarkCell=function(a,b){var c=a%2===0,d=b%2===0;return!c&&d||c&&!d},a.hasPiece=function(b,c){var d={row:b,col:c},e=p(d);return a.isDarkCell(e.row,e.col)&&!D(a.board)&&"DS"!==a.board[e.row][e.col]},a.getPieceSrc=function(b,c){var d={row:b,col:c},e=p(d),f="imgs/",g=".png";if(a.hasPiece(b,c))switch(a.board[e.row][e.col]){case"BM":return f+"black_man"+g;case"BK":return f+"black_cro"+g;case"WM":return f+"white_man"+g;case"WK":return f+"white_cro"+g}return f+"empty"+g};var E=function(){try{var a=g.getFirstMove();e.makeMove(a)}catch(c){b.info(c),b.info("initialGame() failed")}};i.setWidthToHeight(1),j.addDragListener("gameArea",k),e.setGame({gameDeveloperEmail:"yl1949@nyu.edu",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:g.isMoveOk,updateUI:w})}]),function(){"use strict";angular.module("myApp").factory("checkersAiService",["checkersLogicService","alphaBetaService",function(a,b){function c(b,c,d){return a.getKind(b)===i.MAN?a.getColor(b)===i.WHITE?1===c?7:5:d===i.ROW-2?7:5:a.getKind(b)===i.KING?10:0}function d(b,d){var e,f,g,h,j,k=0,l=[[0,4,0,4,0,4,0,4],[4,0,3,0,3,0,3,0],[0,3,0,2,0,2,0,4],[4,0,2,0,1,0,3,0],[0,3,0,1,0,2,0,4],[4,0,2,0,2,0,3,0],[0,3,0,3,0,3,0,4],[4,0,4,0,4,0,4,0]];if(e=a.getWinner(b,d),e===i.WHITE)return Number.MIN_VALUE;if(e===i.BLACK)return Number.MAX_VALUE;for(h=0;h<i.ROW;h+=1)for(j=0;j<i.COLUMN;j+=1)f=b[h][j],f!==i.LIGHT_SQUARE&&f!==i.DARK_SQUARE&&(g=c(f,h,j)*l[h][j],a.getColor(f)===i.BLACK?k+=g:k-=g);return k}function e(a,b){return-d(a[1].set.value,b)}function f(b,c){var d,e,f,g,h,j,k=[];for(d=a.hasMandatoryJumps(b,c),g=0;g<i.ROW;g+=1)for(h=0;h<i.COLUMN;h+=1)if(a.isOwnColor(c,b[g][h].substr(0,1)))for(f={row:g,col:h},e=d?a.getJumpMoves(b,f,c):a.getSimpleMoves(b,f,c),j=0;j<e.length;j+=1)k.push([f,e[j]]);return k}function g(b,c){for(var d=b[1].set.value,e=f(d,c),g=[],h=0;h<e.length;h++)g[h]=a.createMove(angular.copy(d),e[h][0],e[h][1],c);return g}function h(a,c,d){return b.alphaBetaDecision([null,{set:{key:"board",value:a}}],c,g,e,null,d)}var i=a.CONSTANTS;return{createComputerMove:h}}])}();
//# sourceMappingURL=everything.min.js.map